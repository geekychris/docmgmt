openapi: 3.0.1
info:
  title: Document Management System API
  description: |
    A comprehensive Document Management System REST API with features including:

    - **Document Management**: Create, read, update, and delete documents
    - **Content Management**: Upload and download content with flexible storage options
    - **Versioning**: Major and minor version control for documents
    - **Content Renditions**: Primary and secondary content renditions with transformations
    - **Full-Text Search**: Lucene-powered search with fielded queries
    - **File Store Management**: Manage multiple file storage locations
    - **Content Transformations**: PDF-to-text and other content transformations

    ## Key Features

    ### Document Types
    - ARTICLE, MANUAL, REPORT, SPREADSHEET, PRESENTATION, IMAGE, VIDEO, AUDIO, OTHER

    ### Storage Options
    - Database storage for small files
    - File system storage for large files
    - Automatic migration between storage types

    ### Search Capabilities
    - Simple text search across all fields
    - Fielded search (name, description, keywords, tags, content)
    - Boolean operators (AND, OR)
    - Phrase search, wildcard search
    - Indexes all document metadata and indexable content

    ### Content Renditions
    - Primary renditions (original content)
    - Secondary renditions (transformed content)
    - Automatic text extraction from PDFs
    - Extensible transformer plugin framework
  contact:
    name: Document Management System
    email: support@docmgmt.com
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  version: 1.0.0
servers:
- url: http://localhost:8082/docmgmt
  description: Local development server
tags:
- name: File Stores
  description: File store management for external content storage
- name: Documents
  description: "Document management operations including creation, versioning, and\
    \ queries"
- name: Content
  description: "Content management operations including upload, download, and storage\
    \ migration"
- name: Search
  description: Full-text search operations using Apache Lucene
paths:
  /api/filestores/{id}:
    get:
      tags:
      - File Stores
      operationId: getFileStoreById
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/FileStoreDTO'
    put:
      tags:
      - File Stores
      operationId: updateFileStore
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FileStoreDTO'
        required: true
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/FileStoreDTO'
    delete:
      tags:
      - File Stores
      operationId: deleteFileStore
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
  /api/filestores/{id}/deactivate:
    put:
      tags:
      - File Stores
      operationId: deactivateFileStore
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/FileStoreDTO'
  /api/filestores/{id}/activate:
    put:
      tags:
      - File Stores
      operationId: activateFileStore
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/FileStoreDTO'
  /api/documents/{id}:
    get:
      tags:
      - Documents
      summary: Get item by ID
      description: Retrieve a specific item by its ID
      operationId: getById
      parameters:
      - name: id
        in: path
        description: Item ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "404":
          description: Item not found
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
        "200":
          description: Item found
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
    put:
      tags:
      - Documents
      summary: Update item
      description: Update an existing item
      operationId: update
      parameters:
      - name: id
        in: path
        description: Item ID
        required: true
        schema:
          type: integer
          format: int64
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocumentDTO'
        required: true
      responses:
        "404":
          description: Item not found
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
        "400":
          description: Invalid input
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
        "200":
          description: Item updated
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
    delete:
      tags:
      - Documents
      summary: Delete item
      description: Delete an item by ID
      operationId: delete
      parameters:
      - name: id
        in: path
        description: Item ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "404":
          description: Item not found
        "204":
          description: Item deleted
  /api/content/{id}/move-to-filestore:
    put:
      tags:
      - Content
      operationId: moveToFileStore
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: fileStoreId
        in: query
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/ContentDTO'
  /api/content/{id}/move-to-database:
    put:
      tags:
      - Content
      operationId: moveToDatabase
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/ContentDTO'
  /api/search/rebuild:
    post:
      tags:
      - Search
      summary: Rebuild search index
      description: Completely rebuild the Lucene search index from all documents in
        the database. This indexes all document metadata and indexable content.
      operationId: rebuildIndex
      responses:
        "500":
          description: Failed to rebuild index
          content:
            '*/*':
              schema:
                type: string
        "200":
          description: Index rebuilt successfully
          content:
            '*/*':
              schema:
                type: string
  /api/search/fields:
    post:
      tags:
      - Search
      summary: Field-specific search
      description: Search specific fields with individual queries. Supports combining
        multiple field queries with AND or OR operators.
      operationId: searchFields
      parameters:
      - name: limit
        in: query
        description: Maximum number of results
        required: false
        schema:
          type: integer
          format: int32
          default: 50
        example: 50
      - name: operator
        in: query
        description: "Boolean operator: AND or OR"
        required: false
        schema:
          type: string
          default: AND
        example: AND
      requestBody:
        description: Map of field names to search queries
        content:
          application/json:
            schema:
              type: string
            examples:
              Multi-field search:
                description: Multi-field search
                value:
                  name: tutorial
                  tags: java
        required: true
      responses:
        "200":
          description: Search completed successfully
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SearchResult'
        "400":
          description: Invalid query syntax
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SearchResult'
  /api/filestores:
    get:
      tags:
      - File Stores
      operationId: getAllFileStores
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FileStoreDTO'
    post:
      tags:
      - File Stores
      operationId: createFileStore
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FileStoreDTO'
        required: true
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/FileStoreDTO'
  /api/documents:
    get:
      tags:
      - Documents
      summary: Get all items
      description: Retrieve all items including all versions
      operationId: getAll
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
    post:
      tags:
      - Documents
      summary: Create item
      description: Create a new item
      operationId: create
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DocumentDTO'
        required: true
      responses:
        "400":
          description: Invalid input
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
        "201":
          description: Item created
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
  /api/documents/{id}/versions/minor:
    post:
      tags:
      - Documents
      summary: Create minor version
      description: "Create a new minor version (e.g., 1.0 → 1.1)"
      operationId: createMinorVersion
      parameters:
      - name: id
        in: path
        description: Item ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "404":
          description: Item not found
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
        "201":
          description: Minor version created
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
  /api/documents/{id}/versions/major:
    post:
      tags:
      - Documents
      summary: Create major version
      description: "Create a new major version (e.g., 1.0 → 2.0)"
      operationId: createMajorVersion
      parameters:
      - name: id
        in: path
        description: Item ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "404":
          description: Item not found
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
        "201":
          description: Major version created
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/DocumentDTO'
  /api/content/upload:
    post:
      tags:
      - Content
      summary: Upload content
      description: Upload a file as content for a document. Can be stored in database
        or file system.
      operationId: uploadContent
      requestBody:
        content:
          application/json:
            schema:
              required:
              - file
              type: object
              properties:
                file:
                  type: string
                  description: File to upload
                  format: binary
                uploadDTO:
                  $ref: '#/components/schemas/ContentUploadDTO'
      responses:
        "500":
          description: Error uploading content
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/ContentDTO'
        "201":
          description: Content uploaded successfully
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/ContentDTO'
        "400":
          description: Invalid request
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/ContentDTO'
  /api/search:
    get:
      tags:
      - Search
      summary: Simple text search
      description: "Search across all document fields (name, description, keywords,\
        \ tags, content) and indexable content using Lucene query syntax. Supports\
        \ wildcards (*), phrase queries (\"exact phrase\"), and boolean operators\
        \ (AND, OR, NOT)."
      operationId: search
      parameters:
      - name: q
        in: query
        description: Search query using Lucene syntax
        required: true
        schema:
          type: string
        example: spring framework
      - name: limit
        in: query
        description: Maximum number of results to return
        required: false
        schema:
          type: integer
          format: int32
          default: 50
        example: 50
      responses:
        "200":
          description: Search completed successfully
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SearchResult'
        "400":
          description: Invalid query syntax
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SearchResult'
  /api/search/stats:
    get:
      tags:
      - Search
      summary: Get search index statistics
      description: Retrieve statistics about the Lucene search index including document
        count and deleted documents.
      operationId: getStats
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            '*/*':
              schema:
                type: object
                additionalProperties:
                  type: object
        "500":
          description: Error retrieving statistics
          content:
            '*/*':
              schema:
                type: object
                additionalProperties:
                  type: object
  /api/filestores/{id}/space:
    get:
      tags:
      - File Stores
      operationId: getAvailableSpace
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/SpaceInfoDTO'
  /api/filestores/{id}/space/check:
    get:
      tags:
      - File Stores
      operationId: hasEnoughSpace
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      - name: requiredBytes
        in: query
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: boolean
  /api/filestores/active:
    get:
      tags:
      - File Stores
      operationId: getActiveFileStores
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FileStoreDTO'
  /api/documents/{id}/versions/history:
    get:
      tags:
      - Documents
      summary: Get version history
      description: Retrieve complete version history for an item
      operationId: getVersionHistory
      parameters:
      - name: id
        in: path
        description: Item ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "404":
          description: Item not found
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SysObjectVersionDTO'
        "200":
          description: Version history retrieved
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SysObjectVersionDTO'
  /api/documents/search:
    get:
      tags:
      - Documents
      summary: Search documents by keywords
      description: Search for documents using keyword matching (searches in the keywords
        field)
      operationId: searchByKeywords
      parameters:
      - name: keywords
        in: query
        description: Keywords to search for
        required: true
        schema:
          type: string
        example: spring boot java
      responses:
        "200":
          description: Documents found
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
        "500":
          description: Internal server error
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
  /api/documents/latest:
    get:
      tags:
      - Documents
      summary: Get latest versions
      description: Retrieve only the latest version of each item
      operationId: getAllLatestVersions
      responses:
        "200":
          description: OK
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
  /api/documents/by-type/{documentType}:
    get:
      tags:
      - Documents
      summary: Find documents by type
      description: "Retrieve all documents of a specific type (ARTICLE, MANUAL, REPORT,\
        \ etc.)"
      operationId: findByDocumentType
      parameters:
      - name: documentType
        in: path
        description: Document type to search for
        required: true
        schema:
          type: string
          enum:
          - ARTICLE
          - REPORT
          - CONTRACT
          - MANUAL
          - PRESENTATION
          - TRIP_REPORT
          - OTHER
      responses:
        "200":
          description: Documents found
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
        "500":
          description: Internal server error
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
  /api/documents/by-tag/{tag}:
    get:
      tags:
      - Documents
      summary: Find documents by tag
      description: Retrieve all documents that contain the specified tag
      operationId: findByTag
      parameters:
      - name: tag
        in: path
        description: Tag to search for
        required: true
        schema:
          type: string
        example: java
      responses:
        "200":
          description: Documents found
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
        "500":
          description: Internal server error
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DocumentDTO'
  /api/content/{id}:
    get:
      tags:
      - Content
      summary: Get content metadata
      description: Retrieve content metadata by ID
      operationId: getContentById
      parameters:
      - name: id
        in: path
        description: Content ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "404":
          description: Content not found
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/ContentDTO'
        "200":
          description: Content found
          content:
            '*/*':
              schema:
                $ref: '#/components/schemas/ContentDTO'
    delete:
      tags:
      - Content
      operationId: deleteContent
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "200":
          description: OK
  /api/content/{id}/download:
    get:
      tags:
      - Content
      summary: Download content
      description: Download the actual content bytes of a content item
      operationId: downloadContent
      parameters:
      - name: id
        in: path
        description: Content ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "500":
          description: Error reading content
          content:
            '*/*':
              schema:
                type: string
                format: binary
        "404":
          description: Content not found
          content:
            '*/*':
              schema:
                type: string
                format: binary
        "200":
          description: Content downloaded
          content:
            '*/*':
              schema:
                type: string
                format: binary
  /api/content/by-sysobject/{sysObjectId}:
    get:
      tags:
      - Content
      summary: List content for document
      description: Retrieve all content items (primary and secondary renditions) for
        a document
      operationId: getContentBySysObject
      parameters:
      - name: sysObjectId
        in: path
        description: Document ID
        required: true
        schema:
          type: integer
          format: int64
      responses:
        "500":
          description: Error retrieving content
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContentDTO'
        "200":
          description: Content list retrieved
          content:
            '*/*':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ContentDTO'
components:
  schemas:
    FileStoreDTO:
      required:
      - name
      - rootPath
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        rootPath:
          type: string
        status:
          type: string
          enum:
          - ACTIVE
          - INACTIVE
        contentCount:
          type: integer
          format: int64
    ContentDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        contentType:
          type: string
        sysObjectId:
          type: integer
          format: int64
        fileStoreId:
          type: integer
          format: int64
        fileStoreName:
          type: string
        storagePath:
          type: string
        size:
          type: integer
          format: int64
        formattedSize:
          type: string
        storageType:
          type: string
        createdAt:
          type: string
          format: date-time
        modifiedAt:
          type: string
          format: date-time
    DocumentDTO:
      required:
      - documentType
      - name
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        majorVersion:
          type: integer
          format: int32
        minorVersion:
          type: integer
          format: int32
        parentVersionId:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
        modifiedAt:
          type: string
          format: date-time
        contents:
          type: array
          items:
            $ref: '#/components/schemas/ContentDTO'
        description:
          type: string
        documentType:
          type: string
          enum:
          - ARTICLE
          - REPORT
          - CONTRACT
          - MANUAL
          - PRESENTATION
          - TRIP_REPORT
          - OTHER
        tags:
          uniqueItems: true
          type: array
          items:
            type: string
        keywords:
          type: string
    SearchResult:
      type: object
      properties:
        documentId:
          type: integer
          format: int64
        score:
          type: number
          format: float
        name:
          type: string
        description:
          type: string
        keywords:
          type: string
        tags:
          type: string
    ContentUploadDTO:
      required:
      - sysObjectId
      type: object
      properties:
        sysObjectId:
          type: integer
          format: int64
        fileStoreId:
          type: integer
          format: int64
        storeInDatabase:
          type: boolean
    SpaceInfoDTO:
      type: object
      properties:
        totalSpace:
          type: integer
          format: int64
        usedSpace:
          type: integer
          format: int64
        id:
          type: integer
          format: int64
        name:
          type: string
        availableSpace:
          type: integer
          format: int64
        formattedAvailableSpace:
          type: string
    SysObjectVersionDTO:
      type: object
      properties:
        id:
          type: integer
          format: int64
        name:
          type: string
        version:
          type: string
        majorVersion:
          type: integer
          format: int32
        minorVersion:
          type: integer
          format: int32
        parentVersionId:
          type: integer
          format: int64
        createdAt:
          type: string
          format: date-time
        modifiedAt:
          type: string
          format: date-time
        isLatestVersion:
          type: boolean
        hasChildVersions:
          type: boolean
